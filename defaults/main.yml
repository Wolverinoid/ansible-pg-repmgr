---
# defaults file for role_name
postgresql_version: "16"
postgresql_cluster_name: "main"
postgresql_conf_directory: "/etc/postgresql/{{ postgresql_version }}/{{ postgresql_cluster_name }}"
postgresql_hba_file: "{{ postgresql_conf_directory }}/pg_hba.conf"

postgresql_admin_user: "postgres"
postgresql_service_user: "{{ postgresql_admin_user }}"
postgresql_service_group: "{{ postgresql_admin_user }}"
postgresql_service_enabled: true
postgresql_default_auth_method_hosts: "md5"
postgresql_default_auth_method: "peer"


# PostgreSQL configuration
postgresql_data_dir: "/var/lib/postgresql/{{ postgresql_version }}/main"
postgresql_config_dir: "/etc/postgresql/{{ postgresql_version }}/main"
postgresql_bin_dir: "/usr/lib/postgresql/{{ postgresql_version }}/bin"
postgresql_service_name: "postgresql@{{ postgresql_version }}-main"

# Replication settings
postgresql_replication_user: "repmgr"
postgresql_replication_password: "repmgr_password"  # Should be changed and stored securely
postgresql_replication_db: "repmgr"

# repmgr configuration
repmgr_conf_dir: "/etc/repmgr"
repmgr_config_file: "{{ repmgr_conf_dir }}/repmgr.conf"
repmgr_log_file: "/var/log/postgresql/repmgr.log"
repmgr_pid_file: "/var/run/repmgr/repmgr.pid"


# PostgreSQL configuration parameters - Common for all nodes
postgresql_common_config_params:
  shared_buffers: 64GB
  max_connections: 100
  max_replication_slots: 10
  listen_addresses: '{{ node_network_name }},localhost'
  wal_level: 'replica'
  wal_log_hints: on
  archive_mode: on
  archive_command: 'cp %p /var/lib/postgresql/16/main/archive/%f'
  max_wal_senders: 10
  wal_keep_size: 64MB
  hot_standby: on
  shared_preload_libraries: 'repmgr'
 
# PostgreSQL configuration parameters - Primary specific
postgresql_primary_config_params: []

# PostgreSQL configuration parameters - Standby specific
postgresql_standby_config_params:
  hot_standby_feedback: false
 

 
 # pg_hba.conf
postgresql_pg_hba_default:
    - { type: host, database: all, user: "{{ postgresql_admin_user }}", address: "127.0.0.1/32", method: "trust", comment: "Local root Unix user, passwordless access" }
    - { type: host, database: all, user: "{{ postgresql_admin_user }}", address: "::1/128", method: "trust", comment: "Local root Unix user, passwordless access" }
    - { type: local, database: all, user: all, address: "",             method: "{{ postgresql_default_auth_method }}", comment: '"local" is for Unix domain socket connections only' }
    - { type: host,  database: all, user: all, address: "127.0.0.1/32", method: "{{ postgresql_default_auth_method_hosts }}", comment: "IPv4 local connections:" }
    - { type: host,  database: all, user: all, address: "::1/128",      method: "{{ postgresql_default_auth_method_hosts }}", comment: "IPv6 local connections:" }
    - { type: local, database: all, user: "{{ postgresql_admin_user }}", address: "", method: "peer map=root_as_{{ postgresql_admin_user }}", comment: "Local root Unix user, passwordless access" }
        
        
   
postgresql_pg_hba_md5_hosts: []
postgresql_pg_hba_passwd_hosts: []
postgresql_pg_hba_trust_hosts: []
postgresql_pg_hba_custom: []

postgresql_users: []
postgresql_databases: []
postgresql_extensions: []
